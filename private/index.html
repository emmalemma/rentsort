<html>
<head>
<script src='js/mootools.js'> </script>
<script src='js/mootools-more.js'> </script>
<script src="js/paradigm.js"> </script>


<script src="js/session.js"> </script>
</head>
<body>
	{=User=}
	<div id="flash"></div>
	
	{%
		$("User").addEvent 'profile_update', (event)->
			for key of $("User").profile
				$("user.#{key}").set 'text', $("User")[key]
			
			$("signup").show()
			$("profile").hide()
	%}
	<div id="profile">
		Where you live: <span id="user.home"></span><br />
		Where you work: <span id="user.work"></span><br />
		Your rent: <span id="user.rent"></span><br />
		Your email: <span id="user._id"></span><br />
	</div>
	
	{%
			$("User").addEvent 'no_user', ->
				$("signup").show()
				$("profile").hide()
	%}
	<div id="signup" style="display:none;">
	<form>
		Where do you live? <input id="home_field" type="text" width=100></input><br />
		Where do you work? <input id="work_field" type="text" width=100></input><br />
		How much is your rent? <input id="rent_field" type="text" width=10></input><br />
		What's your email? <input id="email_field" type="text"></input><br />
		<span id="savebutton" >Sign up!</span>
	</form>
	{%
		$("email_field").addEvent 'keydown', (event)->
												$('flash').hide()
												showflash =(res)->$('flash').show('inline').set('text',res.flash)
												$validate_user_email event.target.value, callback:showflash
												
		$("savebutton").addEvent 'click', (event)->
													
													$('flash').hide()
													$save_new_user email:$('email_field').value, 
																	callback:(resp)->
																					if resp.success
																						$('signup').hide()
																					else
																						$('flash').show().set('text', resp.error)
	%}
	</div>
</body>
</html>